<!--
  ~ Copyright (C) 2017/2021 e-voyageurs technologies
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="d-flex flex-wrap mt-3 mb-2">
  <h1 class="flex-grow-1">
    <ng-container *ngIf="state.applications.length === 0"> Welcome! Please create your first Application </ng-container>
    <ng-container *ngIf="state.applications.length !== 0">Applications</ng-container>
  </h1>

  <section
    class="grid-actions"
    *ngIf="isAdmin()"
  >
    <button
      nbButton
      ghost
      shape="round"
      nbTooltip="Upload dump"
      (click)="showUploadDumpPanel()"
    >
      <nb-icon icon="cloud-upload-outline"></nb-icon>
    </button>

    <button
      nbButton
      status="primary"
      routerLink="create"
      nbTooltip="Create new application"
    >
      <nb-icon icon="plus-outline"></nb-icon>
      NEW APPLICATION
    </button>
  </section>
</div>

<nb-card
  *ngFor="let app of state.applications"
  class="mb-2"
>
  <nb-card-body>
    <div class="d-flex gap-1 align-items-center">
      <nb-toggle
        *ngIf="app._id === state.currentApplication._id"
        checked="true"
        class="mb-0 nb-toggle-clear-bottom-margin unClickable"
      ></nb-toggle>
      <nb-toggle
        *ngIf="app._id !== state.currentApplication._id"
        checked="false"
        (checkedChange)="selectApplication(app)"
        class="mb-0 nb-toggle-clear-bottom-margin"
        nbTooltip="Set as current application"
      ></nb-toggle>

      <span [ngClass]="{ 'font-weight-bold': app._id === state.currentApplication._id }">{{ app.label }}</span>

      <div class="flex-grow-1 text-muted">
        <span *ngFor="let locale of app.supportedLocales; let last = last">
          {{ state.localeName(locale) }}
          <ng-container *ngIf="!last">|</ng-container>
        </span>
      </div>

      <button
        *ngIf="isAdmin()"
        nbButton
        ghost
        shape="round"
        (click)="downloadDump(app)"
        nbTooltip="Download an application dump"
      >
        <nb-icon icon="cloud-download-outline"></nb-icon>
      </button>
      <button
        *ngIf="isAdmin()"
        nbButton
        ghost
        shape="round"
        (click)="downloadSentencesDump(app)"
        nbTooltip="Download a sentences dump"
      >
        <nb-icon icon="download-outline"></nb-icon>
      </button>

      <button
        *ngIf="isAdmin()"
        nbButton
        ghost
        shape="round"
        routerLink="edit/{{ app._id }}"
        nbTooltip="Edit application"
      >
        <nb-icon icon="edit"></nb-icon>
      </button>
    </div>
  </nb-card-body>
</nb-card>
