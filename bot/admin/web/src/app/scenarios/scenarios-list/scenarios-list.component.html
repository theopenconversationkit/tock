<div class="d-flex justify-content-between align-items-center flex-wrap mb-2 gap-1">
  <h1 class="flex-grow-1">Scenarios Management</h1>

  <section class="d-flex flex-wrap header-actions">
    <button
      nbButton
      ghost
      shape="round"
      nbTooltip="Export scenarios dumps"
      [disabled]="!configurations?.length || !scenariosGroups.length"
      (click)="openExportScenario()"
    >
      <nb-icon icon="download-outline"></nb-icon>
    </button>
    <button
      nbButton
      ghost
      shape="round"
      nbTooltip="Import scenarios dumps"
      [disabled]="!configurations?.length"
      (click)="openImportScenario()"
    >
      <nb-icon icon="upload-outline"></nb-icon>
    </button>
    <button
      nbButton
      ghost
      shape="round"
      nbTooltip="Settings"
      [disabled]="!configurations?.length"
      (click)="openSettings()"
    >
      <nb-icon icon="settings-outline"></nb-icon>
    </button>
    <button
      nbButton
      status="primary"
      [disabled]="!configurations?.length"
      (click)="addOrEditScenarioGroup()"
    >
      <nb-icon icon="plus-outline"></nb-icon>
      Create
    </button>
  </section>
</div>

<section [class.grid]="isSidePanelOpen.edit || isSidePanelOpen.export || isSidePanelOpen.import || isSidePanelOpen.settings">
  <tock-no-bot-configuration *ngIf="configurations?.length === 0"></tock-no-bot-configuration>

  <div
    *ngIf="configurations?.length"
    class="main"
  >
    <tock-scenario-filters
      class="d-block mb-2"
      (onFilter)="filterScenariosGroups($event)"
    ></tock-scenario-filters>

    <div
      class="d-flex justify-content-end mb-2"
      *ngIf="!loading.list && paginatedScenariosGroups?.length"
    >
      <tock-pagination
        [pagination]="pagination"
        (onPaginationChange)="paginationChange($event)"
      ></tock-pagination>
    </div>

    <div
      class="loading"
      [nbSpinner]="loading.list"
    >
      <tock-no-data-found
        *ngIf="!loading.list && !paginatedScenariosGroups.length"
        title="No Scenario found"
        message="You may create a new one using above button &#34;Create&#34;."
      ></tock-no-data-found>

      <tock-scenario-list-simple
        *ngIf="!loading.list && paginatedScenariosGroups.length"
        [nbSpinner]="loading.delete"
        [scenariosGroups]="paginatedScenariosGroups"
        [selectedScenarioGroup]="scenarioGroupEdit"
        (onDeleteScenarioGroup)="deleteScenarioGroup($event)"
        (onEditScenarioGroup)="addOrEditScenarioGroup($event)"
        (onDuplicateScenarioVersion)="askDuplicationScenarioVersion($event)"
        (onDeleteScenarioVersion)="deleteScenarioVersion($event)"
        (onToggleScenarioGroup)="toggleTickScenarioGroup($event)"
        (onOrderBy)="orderBy($event)"
      ></tock-scenario-list-simple>
    </div>
  </div>

  <tock-scenario-edit
    #scenarioEditComponent
    *ngIf="isSidePanelOpen.edit"
    class="aside"
    [loading]="loading.edit"
    [scenarioGroup]="scenarioGroupEdit"
    (onClose)="closeSidePanel('edit')"
    (onSave)="saveScenarioGroupUnknownAnswers($event)"
  ></tock-scenario-edit>

  <tock-scenario-import
    #scenarioImportComponent
    *ngIf="isSidePanelOpen.import"
    class="aside"
    [scenariosGroups]="scenariosGroups"
    (onClose)="closeSidePanel('import')"
  ></tock-scenario-import>

  <tock-scenario-export
    #scenarioExportComponent
    *ngIf="isSidePanelOpen.export"
    class="aside"
    [scenariosGroups]="scenariosGroups"
    (onClose)="closeSidePanel('export')"
  ></tock-scenario-export>

  <tock-scenarios-settings
    #scenarioSettingsComponent
    *ngIf="isSidePanelOpen.settings"
    class="aside"
    (onClose)="closeSidePanel('settings')"
  ></tock-scenarios-settings>
</section>

<ng-template #duplicationModal>
  <nb-card>
    <nb-card-header class="d-flex justify-content-between align-items-start gap-1">
      Duplicate a scenario version
      <button
        nbButton
        ghost
        shape="round"
        nbTooltip="Cancel"
        (click)="duplicationCancel()"
      >
        <nb-icon icon="close-outline"></nb-icon>
      </button>
    </nb-card-header>
    <nb-card-body>
      <form
        [formGroup]="duplicationForm"
        (submit)="duplicationSubmit()"
      >
        <tock-form-control
          label="Version comment"
          name="comment"
          required="true"
          [controls]="comment"
          [showError]="isDuplicationSubmitted"
          [hasMargin]="false"
        >
          <textarea
            tockAutofocusElement
            nbInput
            formControlName="comment"
            fullWidth
            id="comment"
            type="text"
            placeholder="Enter a comment"
          ></textarea>
        </tock-form-control>
      </form>
    </nb-card-body>
    <nb-card-footer class="card-footer-actions">
      <button
        nbButton
        ghost
        size="small"
        (click)="duplicationCancel()"
      >
        Cancel
      </button>
      <button
        nbButton
        status="primary"
        size="small"
        (click)="duplicationSubmit()"
        [disabled]="!canSaveDuplication"
      >
        Duplicate
      </button>
    </nb-card-footer>
  </nb-card>
</ng-template>
