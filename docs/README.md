# Tock documentation 

## How to generate website

##### Using pyenv && poetry (recommended)

It's recommended to use pyenv, see install and usage guide here:
https://gist.github.com/trongnghia203/9cc8157acb1a9faad2de95c3175aa875

Basic usage to create a venv with a specific version of Python for this project :

```sh
# In docs folder
pyenv install 3.13.0
pyenv local 3.13.0  # Activate Python 3.9 for the current
which python # Check that you use the python version installed by pyenv
python --version # Check your python version
python -m venv .venv # Create a virtual env based on this python version
source .venv/bin/activate # Activate your virtual env
pip install -r  requirements.txt # install dependencies
mkdocs serve # Generate on default port 
mkdocs serve --dev-addr 127.0.0.1:8182 # To generate the website on the port you want 
```

To enable the git-committers plugin in MkDocs, configure the MKDOCS_GIT_COMMITTERS_APIKEY environment variable in your .bashrc file as follows:

export MKDOCS_GIT_COMMITTERS_APIKEY=[your_github_token].

Ensure the GitHub token you provide has the necessary repo permissions to access repository data. After adding this line, reload your shell configuration with source ~/.bashrc to apply the changes.


## Actions / Workflows 

This project uses GitHub Actions to deploy and clean up branches, and it contains two different workflows:


The first one is for deployment, it automatically deploys the MkDocs documentation to GitHub Pages when a push is made to certain branches. It proceeds as follows:


- Trigger: PUSH
- Retrieve the code from the relevant branch.
- Retrieve the artifact from the last successful build (if it exists).
- Install MkDocs dependencies.
- Compile the MkDocs site in docs/site/.
- Upload the generated site as an artifact. In GitHub Actions, an artifact is a file or folder generated by a workflow and stored for later reuse. 
- Here, it contains the content necessary for deployment.
- Deploy to GitHub Pages.
- Update the deployment URL based on the branch.
- Add a comment in the PR (if applicable) with the link to the deployed site.


The second one deletes the MkDocs static files from a branch after the PR is closed, or on manual command. It proceeds as follows:

- Trigger: PR closure or manual launch via workflow_dispatch (by selecting the branch)
- Retrieve the repository.
- Retrieve the artifact containing the MkDocs files.
- Check the content of the artifact.
- Delete the folder associated with the closed branch.
- Upload the updated files.
- Add a comment in the PR to indicate the success of the cleanup.


PS: It is possible to view the content of the artifact in the action at the "Upload static files as artifact" step in the build job, which is located at the last line of the block in the form:

Artifact download URL: https://github.com/titouvgx/tock/actions/runs/13155545671/artifacts/2539935809


